
@{
    ViewData["Title"] = "Dashboard";
}

<style>
    body {
        background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
    }
    .dashboard-card {
        border-radius: 18px;
        box-shadow: 0 4px 24px rgba(0,95,163,0.10);
        transition: transform 0.15s, box-shadow 0.15s;
        background: #fff;
        position: relative;
        overflow: hidden;
    }
    .dashboard-card:hover {
        transform: translateY(-4px) scale(1.03);
        box-shadow: 0 8px 32px rgba(0,95,163,0.18);
    }
    .dashboard-card .icon-bg {
        position: absolute;
        top: -30px; right: -30px;
        font-size: 5rem;
        color: #005fa3;
        opacity: 0.07;
        z-index: 0;
    }
    .dashboard-card .card-body {
        position: relative;
        z-index: 1;
    }
    .dashboard-badge {
        background: linear-gradient(90deg, #005fa3 0%, #ffd700 100%);
        color: #fff;
        border-radius: 12px;
        font-size: 0.95em;
        padding: 0.2em 0.7em;
        font-weight: 600;
        margin-left: 0.5em;
    }
    .dashboard-title {
        font-family: 'Segoe UI', sans-serif;
        font-weight: 800;
        color: #003366;
        letter-spacing: 1px;
    }
    .dashboard-section-title {
        color: #005fa3;
        font-weight: 700;
        margin-bottom: 1em;
    }
    .dashboard-graph {
        border-radius: 12px;
        background: #f8fafc;
        padding: 1em;
        box-shadow: 0 2px 8px rgba(0,95,163,0.06);
    }
    .dashboard-list li {
        margin-bottom: 0.5em;
        font-size: 1.08em;
    }
</style>


<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="dashboard-title mb-2"><i class="fas fa-user-shield me-2 text-primary"></i>Panel de Administración</h1>
            @{
                string rol = "";
                if (User.IsInRole("Administrador")) { rol = "Administrador"; }
                else if (User.IsInRole("Recepcionista")) { rol = "Recepcionista"; }
                else if (User.IsInRole("Gerente")) { rol = "Gerente"; }
                else if (User.IsInRole("Empleado")) { rol = "Empleado"; }
                else { rol = "Usuario"; }
            }
            <span class="dashboard-badge">@rol</span>
            <p class="text-muted mt-2">Accede a la gestión completa del hotel, visualiza estadísticas, administra usuarios, habitaciones, reservas y más.</p>
        </div>
    </div>
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-users"></i></span>
                <div class="card-body">
                    <i class="fas fa-users fa-3x text-primary mb-2"></i>
                    <h5 class="card-title">Clientes registrados</h5>
                    <p class="card-text display-5">@(ViewBag.Clientes > 0 ? ViewBag.Clientes : "0")</p>
                    <a asp-controller="Clientes" asp-action="Index" class="btn btn-outline-primary btn-sm mt-2"><i class="fas fa-eye"></i> Ver Clientes</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-user-tie"></i></span>
                <div class="card-body">
                    <i class="fas fa-user-tie fa-3x text-info mb-2"></i>
                    <h5 class="card-title">Empleados</h5>
                    <p class="card-text display-5">@(ViewBag.Empleados > 0 ? ViewBag.Empleados : "0")</p>
                    @if (User.IsInRole("Administrador") || User.IsInRole("Gerente")) {
                        <a asp-controller="Empleados" asp-action="Index" class="btn btn-outline-info btn-sm mt-2"><i class="fas fa-eye"></i> Ver Empleados</a>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-bed"></i></span>
                <div class="card-body">
                    <i class="fas fa-bed fa-3x text-success mb-2"></i>
                    <h5 class="card-title">Habitaciones</h5>
                    <p class="card-text display-5">@(ViewBag.Habitaciones > 0 ? ViewBag.Habitaciones : "0")</p>
                    <a asp-controller="Habitaciones" asp-action="Index" class="btn btn-outline-success btn-sm mt-2"><i class="fas fa-eye"></i> Ver Habitaciones</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-calendar-check"></i></span>
                <div class="card-body">
                    <i class="fas fa-calendar-check fa-3x text-warning mb-2"></i>
                    <h5 class="card-title">Reservas activas</h5>
                    <p class="card-text display-5">@(ViewBag.Reservas > 0 ? ViewBag.Reservas : "0")</p>
                    <a asp-controller="Reservas" asp-action="Index" class="btn btn-outline-warning btn-sm mt-2"><i class="fas fa-eye"></i> Ver Reservas</a>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-file-invoice-dollar"></i></span>
                <div class="card-body">
                    <i class="fas fa-file-invoice-dollar fa-3x text-danger mb-2"></i>
                    <h5 class="card-title">Facturación total</h5>
                    <p class="card-text display-5">$@(ViewBag.Facturacion > 0 ? ViewBag.Facturacion.ToString("N2") : "0.00")</p>
                    <a asp-controller="Facturas" asp-action="Index" class="btn btn-outline-danger btn-sm mt-2"><i class="fas fa-eye"></i> Ver Facturas</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-percentage"></i></span>
                <div class="card-body">
                    <i class="fas fa-percentage fa-3x text-secondary mb-2"></i>
                    <h5 class="card-title">Ocupación actual</h5>
                    <p class="card-text display-5">@(ViewBag.OcupacionPorc > 0 ? ViewBag.OcupacionPorc + "%" : "0%")</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-door-open"></i></span>
                <div class="card-body">
                    <i class="fas fa-door-open fa-3x text-dark mb-2"></i>
                    <h5 class="card-title">Habitaciones libres</h5>
                    <p class="card-text display-5">@(ViewBag.Libres > 0 ? ViewBag.Libres : "0")</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card text-center p-4 position-relative border-0 shadow-lg">
                <span class="icon-bg"><i class="fas fa-bell"></i></span>
                <div class="card-body">
                    <i class="fas fa-bell fa-3x text-warning mb-2"></i>
                    <h5 class="card-title">Notificaciones</h5>
                    <p class="card-text display-5">@((ViewBag.Notificaciones as List<string>)?.Count ?? 0)</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="dashboard-card dashboard-graph border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-chart-line me-2 text-primary"></i>Ocupación semanal</h5>
                    <img src="https://quickchart.io/chart?c={type:'line',data:{labels:['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'],datasets:[{label:'Ocupación',data:[60,75,80,90,85,70,65],borderColor:'blue',fill:false}]}}" class="img-fluid" alt="Gráfico ocupación semanal" />
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="dashboard-card dashboard-graph border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-pie-chart me-2 text-success"></i>Distribución de habitaciones</h5>
                    @if (ViewBag.Habitaciones > 0)
                    {
                        <img src="https://quickchart.io/chart?c={type:'pie',data:{labels:['Suite','Doble','Individual'],datasets:[{data:[5,12,7],backgroundColor:['#005fa3','#ffd700','#003366']}]} }" class="img-fluid" alt="Gráfico habitaciones" />
                    }
                    else
                    {
                        <div class="text-muted">Sin datos para mostrar gráfico</div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-calendar-alt me-2 text-primary"></i>Próximos Check-ins</h5>
                    <table class="table table-sm table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Cliente</th>
                                <th>Habitación</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                        @if (ViewBag.ProximosCheckins != null)
                        {
                            foreach (var r in (IEnumerable<dynamic>)ViewBag.ProximosCheckins)
                            {
                                <tr>
                                    <td><i class="fas fa-user text-primary"></i> @r.Cliente?.Nombre @r.Cliente?.Apellido</td>
                                    <td>@r.Habitacion?.Numero (@r.Habitacion?.Tipo)</td>
                                    <td>@r.FechaEntrada.ToString("yyyy-MM-dd")</td>
                                    <td><span class="badge @(r.Estado == "Confirmado" ? "bg-success" : "bg-warning text-dark")">@r.Estado</span></td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr><td colspan="4">Sin próximos check-ins</td></tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-trophy me-2 text-warning"></i>Ranking de Habitaciones</h5>
                    <ol class="list-group list-group-numbered mb-0">
                        @if (ViewBag.RankingHabitaciones != null)
                        {
                            foreach (var h in (IEnumerable<dynamic>)ViewBag.RankingHabitaciones)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    @h.Nombre <span class="badge bg-primary rounded-pill">@h.Reservas reservas</span>
                                </li>
                            }
                        }
                        else
                        {
                            <li class="list-group-item">Sin datos de ranking</li>
                        }
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-bell me-2 text-danger"></i>Notificaciones recientes</h5>
                    <ul class="list-group mb-0">
                        @if (ViewBag.Notificaciones != null)
                        {
                            foreach (var n in (IEnumerable<string>)ViewBag.Notificaciones)
                            {
                                <li class="list-group-item">@Html.Raw(n)</li>
                            }
                        }
                        else
                        {
                            <li class="list-group-item">Sin notificaciones</li>
                        }
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title dashboard-section-title"><i class="fas fa-chart-bar me-2 text-success"></i>Ocupación actual</h5>
                    <div class="progress mb-2" style="height: 2rem;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: @(ViewBag.OcupacionPorc > 0 ? ViewBag.OcupacionPorc : 0)% ; font-size:1.1em;" aria-valuenow="@ViewBag.OcupacionPorc" aria-valuemin="0" aria-valuemax="100">@(ViewBag.OcupacionPorc > 0 ? ViewBag.OcupacionPorc + "% Ocupado" : "Sin ocupación")</div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-bed text-primary"></i> @(ViewBag.Ocupadas > 0 ? ViewBag.Ocupadas : 0) ocupadas</span>
                        <span><i class="fas fa-door-open text-secondary"></i> @(ViewBag.Libres > 0 ? ViewBag.Libres : 0) libres</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
